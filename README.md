# Stop_images

Streamlit-приложение для **пакетной проверки изображений по URL** через **скрапинг страницы результатов TinEye**.

## Возможности

- Ручной ввод URL (по одному на строку).
- Загрузка XLS/XLSX с шапкой и неограниченным числом строк.
- Автосопоставление обязательных колонок (без учета регистра/пробелов, `ё=е`).
- Ручное сопоставление колонок через UI, если автоматика не справилась.
- Пакетная обработка: стартовая строка + размер партии (50/100/200).
- Настройка `top_n` результатов на одно изображение.
- Фильтрация совпадений только по списку стоков из конфига (`paid/free/mixed`).
- Итоговый XLSX-отчет по партии (только совпадения на стоках).
- SQLite-хранилище: кэш результатов, статусы строк, прогресс партий.

## Структура проекта

- `app.py` — Streamlit UI и оркестрация batch-процесса.
- `tineye_client.py` — клиент скрапинга страницы результатов TinEye.
- `excel_io.py` — чтение XLS/XLSX и формирование итогового отчета.
- `mapping.py` — нормализация заголовков и сопоставление колонок.
- `storage.py` — SQLite (кэш, статусы, история партий).
- `config.py` — загрузка и применение правил стоковых доменов.
- `stocks_config.json` — конфиг доменов и типов источника.

## Настройка для Streamlit Cloud

1. Установите зависимости:

```bash
pip install -r requirements.txt
```

2. Добавьте Secrets (локально в `.streamlit/secrets.toml` или в Streamlit Cloud → App settings → Secrets):

```toml
TINEYE_BASE_URL = "https://tineye.com"
```

> Если `TINEYE_BASE_URL` не задан, используется значение по умолчанию `https://tineye.com`.

3. Запустите приложение:

```bash
streamlit run app.py
```

## Формат конфигурации стоков

`stocks_config.json`:

```json
{
  "paid": ["shutterstock.com", "stock.adobe.com"],
  "mixed": ["freepik.com", "canva.com/photos"],
  "free": ["unsplash.com", "pexels.com"]
}
```

Допустимы записи вида `domain/path-prefix` (например `canva.com/photos`).

## Формат отчета XLSX

Столбцы строго в порядке:

1. Дата проверки (`ДД.ММ.ГГГГ ЧЧ:ММ`)
2. Код изображения
3. Наименование товара
4. Поставщик
5. Менеджер
6. Ссылка на изображение
7. Ссылка на сток
8. Тип источника (`paid/free/mixed`)

В отчет попадают только строки, где найдено совпадение на домене из `stocks_config.json`.
Пустой отчет допустим.
