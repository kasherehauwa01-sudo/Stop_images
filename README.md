# Stop_images

Streamlit-приложение для проверки изображений по новой механике:

1. На вход дается ссылка на **раздел сайта**.
2. Приложение скрапит ссылки на карточки товаров в разделе.
3. Для каждой карточки извлекает артикул и изображение.
4. Загружает изображение в веб-интерфейс TinEye (как ручной Search image on TinEye) и считывает результаты.
5. Если среди результатов есть домены из `stocks_config.json`, добавляет запись в отчет.

## Отчет XLSX

Колонки отчета:

1. `Артикул товара`
2. `Ссылка на сайт`
3. `Ссылка на сток`

`Ссылка на сток` берется из результатов TinEye (любая подходящая ссылка, попавшая в список стоков).

## Входные данные

- Ручной ввод URL разделов (по одному на строку).
- Загрузка XLS/XLSX с колонкой ссылки на раздел.

Автосопоставление заголовков поддерживается (без учета регистра, пробелов, `ё=е`).

## Настройка

```bash
pip install -r requirements.txt
streamlit run app.py
```

Опционально в `.streamlit/secrets.toml`:

```toml
TINEYE_BASE_URL = "https://tineye.com"
```

## Важно

- Ошибки отдельных карточек не останавливают обработку.
- Кэш и прогресс партий сохраняются в SQLite (`cache.db`).

- Для повышения точности извлечения изображения используются `og:image`, JSON-LD (`image`) и типовые галереи карточки.
- В логах интерфейса показываются выбранное изображение и ссылки из результатов TinEye для диагностики.


## Интерфейс

- Вкладка **Пакетная проверка разделов**: обработка разделов сайта партиями.
- Вкладка **Проверка URL**: проверка одной страницы товара по URL.

Параметры `top_n` и `Стартовая карточка` убраны из интерфейса; используется фиксированный лимит результатов TinEye в коде.
