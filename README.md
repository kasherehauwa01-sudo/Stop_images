# Stop_images

Веб-сервис на Streamlit для проверки изображений по URL и поиска совпадений на фотостоках через Bing Visual Search API.

## Что умеет

- Принимает URL вручную (по одной ссылке на строку).
- Загружает XLS/XLSX и автоматически сопоставляет колонки.
- Показывает ручное сопоставление колонок при неоднозначности.
- Получает изображение по прямой ссылке или из HTML-страницы (`og:image`, затем основное `<img>`).
- Выполняет reverse image search только через Bing Visual Search API.
- Фильтрует найденные совпадения по конфигу доменов фотостоков.
- Определяет тип источника: `paid` / `free` / `mixed`.
- Формирует итоговый XLSX-отчет в нужном порядке колонок.
- Использует SQLite-кэш по хэшу изображения, чтобы не повторять поиск.

## Настройка

1. Установите зависимости:

```bash
pip install -r requirements.txt
```

2. Добавьте секреты для Streamlit в `.streamlit/secrets.toml`:

```toml
BING_API_KEY = "your_key"
# необязательно, по умолчанию стандартный endpoint
BING_VISUAL_SEARCH_ENDPOINT = "https://api.bing.microsoft.com/v7.0/images/visualsearch"
```

3. Запустите приложение:

```bash
streamlit run app.py
```

## Конфигурация стоков

Доменный список и тип источника находятся в `stocks_config.json`.
Можно обновлять список без изменений Python-кода.

## Ограничения обработки URL

- Таймаут: до 20 секунд.
- Максимальный размер файла: 25 МБ.
- Поддерживаются редиректы.
- Проверяется `content-type` на `image/*`.
